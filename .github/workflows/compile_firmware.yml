name: Compile Firmware
on:
  push:
    branches: [ develop, test_ci ]
jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - name: install dependencies
      run: sudo apt install cmake arm-none-eabi-gcc
    - name: create build directory
      run: mkdir build
    - name: run cmake
      run: cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/toolchain/gcc-stm32f303xe.toolchain ..
      working-directory: ./build
    - name: run cmake build
      run: cmake --build .
      working-directory: ./build
    - uses: actions/upload-artifact@v2
      with:
        name: firmware.elf
        path: build/firmware.elf
    - uses: actions/upload-artifact@v2
      with:
        name: firmware.hex
        path: build/firmware.hex